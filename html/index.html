<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagEfrei - Bienvenue</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@latest/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/app.js" defer></script>
    <script>
        document.addEventListener("alpine:init", () => {
            Alpine.data("theme", () => ({
                isDark: Alpine.$persist(false).as("isDark"),
                toggle() {
                    this.isDark = !this.isDark;
                },
            }));
        });
    </script>
</head>
<body x-data="theme" :class="isDark ? 'dark-mode' : 'light-mode'" class="h-full">
    <header>
        <img src="../images/Efrei.png" alt="Logo">
        <nav>
            <a href="../html/index.html">Produits</a>
            <a href="../html/map.html">Nos Magasins</a>
            <a href="#" id="panierLink">Panier</a>
            <button @click="toggle" class="ml-4">
                <i class="ph-bold text-xl" :class="isDark ? 'ph-sun' : 'ph-moon'"></i>
            </button>
        </nav>
    </header>
    <div class="titre">
        <h1>Bienvenue chez MagEfrei</h1>
    </div>

    <div class="content" x-data="{
        search: '',
        produits: [
            { id: 1, nom: 'Avocat', prix: 1, offre: '2 achetés = 2,5€', details: 'Détails du produit', image: '../images/Avocat.png' },
            { id: 2, nom: 'Saumon', prix: 10, offre: 'PROMO : -20%', details: 'Détails du produit', image: '../images/saumon.jpg' },
            { id: 3, nom: 'Pain', prix: 4, offre: '1 acheté = 1 offert', details: 'Détails du produit', image: '../images/pain.jpg' },
            { id: 4, nom: 'Shampoing', prix: 5, offre: '34% d\'économies', details: 'Détails du produit', image: '../images/shampoing.jpg' },
            { id: 5, nom: 'Coca-Cola', prix: 2, offre: 'Le 2ème à -60%', details: 'Détails du produit', image: '../images/coca.webp' }
        ],
        cart: [],
        addToCart(produit) {
            const itemInCart = this.cart.find(item => item.id === produit.id);
            if (itemInCart) {
                itemInCart.quantity++;
            } else {
                this.cart.push({ ...produit, quantity: 1 });
            }
            document.getElementById('popup').style.display = 'flex';
        },
        totalPrix() {
            return this.cart.reduce((total, item) => total + item.prix * item.quantity, 0) + ' €';
        },
        increment(item) {
            item.quantity++;
        },
        decrement(item) {
            if (item.quantity > 1) {
                item.quantity--;
            }
        },
        viderPanier() {
            this.cart = [];
        }
    }">
        <div class="search-bar">
            <input x-model="search" placeholder="Rechercher un produit">
        </div>
        <div class="produits">
            <template x-for="produit in produits.filter(p => p.nom.toLowerCase().includes(search.toLowerCase()))" :key="produit.id">
                <div class="produit">
                    <img :src="produit.image" :alt="produit.nom">
                    <h3 x-text="produit.nom"></h3>
                    <p class="prix" x-text="produit.prix + ' €'"></p>
                    <p class="offre" x-text="produit.offre"></p>
                    <button @click="addToCart(produit)">Ajouter au panier</button>
                    <div x-data="{ open: false }">
                        <button @click="open = !open" class="en-savoir-plus">En savoir plus</button>
                        <div x-show="open" class="details" x-text="produit.details"></div>
                    </div>
                </div>
            </template>
        </div>
        <div id="popup" class="popup">
            <div class="popup-content">
                <h2>Votre Panier</h2>
                <ul>
                    <template x-for="item in cart" :key="item.id">
                        <li>
                            <div>
                                <span x-text="item.nom + ' - ' + item.prix + ' €'"></span>
                                <button @click="decrement(item)">-</button>
                                <span x-text="item.quantity"></span>
                                <button @click="increment(item)">+</button>
                            </div>
                        </li>
                    </template>
                    <template x-if="cart.length === 0">
                        <li>Aucun produit dans le panier.</li>
                    </template>
                </ul>
                <p><strong>Total:</strong> <span x-text="totalPrix()"></span></p>
                <button id="closeButton">Fermer</button>
                <button id="viderPanier" @click="viderPanier()">Vider le panier</button>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 MagEfrei - Tous droits réservés.</p>
        <p>
            <a href="#">Conditions générales d'utilisation</a> | 
            <a href="#">Politique de confidentialité</a> | 
            <a href="#">Nous contacter</a>
        </p>
    </footer>
</body>
</html>
